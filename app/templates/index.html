{% extends "base.html" %}

{% block title %}Inicio | Biblioteca Apostólica{% endblock %}
{% block body_class %}page-home{% endblock %}

{% block masthead %}
<section class="hero hero--home">
  <div class="hero__badge">Apostolic Assembly of the Faith in Christ Jesus</div>
  <div class="hero__inner">
    <div class="hero__content">
      <h1>Biblioteca Apostólica</h1>
      <p>
        Custodia y comparte los recursos de tu congregación desde un espacio
        seguro, moderno y alineado a nuestra identidad.
      </p>
      <div class="hero__actions">
        <a class="button button--primary" href="/library">Explorar biblioteca</a>
        {% if current_user %}
        {% if current_user.is_superuser %}
        <a class="button button--outline" href="/admin/upload">Panel de administración</a>
        {% endif %}
        {% else %}
        <a class="button button--ghost" href="/register">Únete a la comunidad</a>
        {% endif %}
      </div>
    </div>
    <div class="hero__media">
      <div class="hero-card">
        <h3 class="hero-card__title">Organiza. Comparte. Inspira.</h3>
        <p class="hero-card__caption">
          Centraliza estudios bíblicos, planificaciones, boletines y más.
        </p>
        <ul class="hero-card__list">
          <li>Compatibilidad con PDF, Word, PowerPoint y texto</li>
          <li>Categorización por ministerios y áreas de servicio</li>
          <li>Acceso rápido y seguimiento de descargas</li>
        </ul>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block surface_class %}surface-home{% endblock %}

{% block content %}
<section class="module module--intro">
  <div class="module__headline">
    <h2>Tu biblioteca digital al servicio de la iglesia</h2>
    <p>
      Conecta a líderes, miembros y voluntarios con materiales actualizados
      desde cualquier dispositivo. Mantén la unidad con un sistema de gestión
      sencillo y fiel a los colores de nuestra Asamblea.
    </p>
  </div>
  <div class="pillars">
    <article class="pillar">
      <h3>Categorías claras</h3>
      <p>
        Mantén cada documento etiquetado por ministerio, jornada o evento para
        encontrarlo en segundos.
      </p>
    </article>
    <article class="pillar">
      <h3>Visor integrado</h3>
      <p>
        Abre los PDF sin salir del sitio y descarga los archivos que necesites
        con un solo clic.
      </p>
    </article>
    <article class="pillar">
      <h3>Control pastoral</h3>
      <p>
        Los superusuarios administran categorías, eliminan archivos y dan la
        bienvenida a nuevos colaboradores.
      </p>
    </article>
  </div>
</section>

<section class="module module--latest">
  <header class="module__header">
    <div>
      <h2>Últimos documentos</h2>
      <p>Los aportes más recientes cargados por la congregación.</p>
    </div>
    <a class="link-arrow" href="/library">Ver biblioteca completa</a>
  </header>
  {% if documents %}
  <ul class="document-feed">
    {% for doc in documents %}
    <li class="document-card document-card--compact">
      <div class="document-card__type" aria-hidden="true">
        {{ "PDF" if doc.content_type == "application/pdf" else "DOC" }}
      </div>
      <div class="document-card__body">
        <h3 class="document-card__title">{{ doc.filename }}</h3>
        <p class="document-card__meta">
          {{ doc.content_type.split('/')[-1].upper() if '/' in doc.content_type else doc.content_type }}
          &middot; {{ doc.uploaded_at.strftime("%d/%m/%Y %H:%M") }}
        </p>
        {% if doc.category %}
        <span class="badge">{{ doc.category.name }}</span>
        {% endif %}
        {% if doc.subcategory %}
        <span class="badge badge--soft">{{ doc.subcategory.name }}</span>
        {% endif %}
      </div>
      <div class="document-card__actions">
        <a
          class="button button--ghost"
          href="/documents/{{ doc.id }}/download"
          data-download-url="/documents/{{ doc.id }}/download"
          data-filename="{{ doc.filename }}"
        >
          Descargar
        </a>
        {% if doc.content_type == "application/pdf" %}
        <a
          class="button button--outline"
          href="/documents/{{ doc.id }}/view"
          data-view-url="/documents/{{ doc.id }}/view"
          data-filename="{{ doc.filename }}"
        >
          Abrir
        </a>
        {% endif %}
        {% if current_user and current_user.is_superuser %}
        <form
          class="action-inline-form"
          action="/documents/{{ doc.id }}/delete"
          method="post"
          data-action="delete-doc"
          data-filename="{{ doc.filename }}"
        >
          <button class="link-danger" type="submit">Eliminar</button>
        </form>
        {% endif %}
      </div>
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <p class="empty empty--center">
    Aún no hay documentos cargados. ¡Comparte el primero!
  </p>
  {% endif %}
</section>

<section class="module module--sermon">
  <header class="module__header">
    <div>
      <h2>Sermón de la semana</h2>
      <p>Accede al último mensaje publicado en la categoría {{ sermon_category_name }}.</p>
    </div>
  </header>
  {% if sermon_document %}
  <article class="sermon-card">
    <div class="sermon-card__head">
      <div class="sermon-card__tags">
        <span class="badge">{{ sermon_document.category.name if sermon_document.category else sermon_category_name }}</span>
        {% if sermon_document.subcategory %}
        <span class="badge badge--soft">{{ sermon_document.subcategory.name }}</span>
        {% endif %}
      </div>
      <time class="sermon-card__date" datetime="{{ sermon_document.uploaded_at.isoformat() }}">
        Subido el {{ sermon_document.uploaded_at.strftime("%d/%m/%Y %H:%M") }}
      </time>
    </div>
    <h3 class="sermon-card__title">{{ sermon_document.filename }}</h3>
    <p class="sermon-card__lead">
      Comparte el mensaje pastoral de esta semana con todos los grupos y ministerios.
    </p>
    <div class="sermon-card__actions">
      <a
        class="button button--primary"
        href="/documents/{{ sermon_document.id }}/download"
        data-download-url="/documents/{{ sermon_document.id }}/download"
        data-filename="{{ sermon_document.filename }}"
      >
        Descargar
      </a>
      {% if sermon_document.content_type == "application/pdf" %}
      <a
        class="button button--outline"
        href="/documents/{{ sermon_document.id }}/view"
        data-view-url="/documents/{{ sermon_document.id }}/view"
        data-filename="{{ sermon_document.filename }}"
      >
        Ver en línea
      </a>
      {% endif %}
    </div>
  </article>
  {% else %}
  <div class="empty-card">
    <h3>Aún no se han compartido sermones</h3>
    <p>
      Sube un recurso a la categoría {{ sermon_category_name }} para destacarlo automáticamente en la portada.
    </p>
    {% if current_user and current_user.is_superuser %}
    <a class="button button--primary" href="/admin/upload">Subir sermón</a>
    {% else %}
    <a class="button button--primary" href="/library">Explorar biblioteca</a>
    {% endif %}
  </div>
  {% endif %}
</section>

<section class="module module--map">
  <header class="module__header">
    <div>
      <h2>Encuéntranos</h2>
      <p>Visita nuestra congregación y comparte la comunión en {{ church_address }}.</p>
    </div>
  </header>
  <div class="map-board" data-map-root>
    <div
      class="map-board__canvas"
      data-map-placeholder
      data-address="{{ church_address }}"
    >
      <p>
        Aquí irá un mapa interactivo. Integra tu proveedor favorito (Mapbox, Google Maps,
        OpenStreetMap, etc.) utilizando el atributo <code>data-address</code> para centrarlo.
      </p>
      <p class="map-board__address">
        Dirección actual: <strong>{{ church_address }}</strong>
      </p>
    </div>
    <aside class="map-board__details">
      <h3>Planifica tu visita</h3>
      <ul>
        <li>Coordina con antelación actividades y reuniones ministeriales.</li>
        <li>Comparte la ubicación con nuevos asistentes y grupos de amistad.</li>
        <li>Actualiza este espacio cuando habilites la API de mapas.</li>
      </ul>
      <a
        class="button button--ghost"
        href="https://www.google.com/maps/search/?api=1&query={{ church_address | urlencode }}"
        target="_blank"
        rel="noopener"
      >
        Abrir en Google Maps
      </a>
    </aside>
  </div>
</section>

{% if current_user and current_user.is_superuser %}
<section class="module module--callout">
  <div class="callout">
    <div class="callout__content">
      <h2>Panel de superusuario</h2>
      <p>
        Gestiona categorías, sube nuevos materiales y mantén la biblioteca al
        día con el panel administrativo.
      </p>
    </div>
    <a class="button button--primary" href="/admin/upload">Ir al panel</a>
  </div>
</section>
{% endif %}
{% endblock %}
